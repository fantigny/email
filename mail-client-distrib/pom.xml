<project xmlns="http://maven.apache.org/POM/4.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>net.anfoya</groupId>
	<artifactId>mail-client-distrib</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<packaging>pom</packaging>
	<description>cross-platform e-mail client</description>

	<properties>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
	</properties>

	<modules>
		<module>../mail-service-api</module>
		<module>../mail-service-gmail</module>
		<module>../mail-common</module>
		<module>../mail-composer</module>
		<module>../mail-browser</module>
		<module>../mail-client</module>
	</modules>

	<dependencies>
		<!-- home made -->
		<dependency>
			<groupId>net.anfoya</groupId>
			<artifactId>mail-client</artifactId>
			<version>0.0.1-SNAPSHOT</version>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<!-- compiling Java 8 for now -->
			<plugin>
				<artifactId>maven-compiler-plugin</artifactId>
				<version>3.7.0</version>
				<configuration>
					<source>1.8</source>
					<target>1.8</target>
				</configuration>
			</plugin>

			<!-- build self contained executable JAR -->
			<plugin>
				<artifactId>maven-shade-plugin</artifactId>
				<version>3.1.0</version>
				<executions>
					<execution>
						<phase>package</phase>
						<configuration>
							<outputFile>target/FisherMail.jar</outputFile>
							<shadedArtifactAttached>true</shadedArtifactAttached>
							<shadedClassifierName>jar-with-dependencies</shadedClassifierName>
							<transformers>
								<transformer
									implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
									<manifestEntries>
										<main-class>net.anfoya.mail.client.javafx.entrypoint.MailClient</main-class>
									</manifestEntries>
								</transformer>
							</transformers>
						</configuration>
						<goals>
							<goal>shade</goal>
						</goals>
					</execution>
				</executions>
			</plugin>

			<!-- build windows binary(x86,x64) from self contained executable JAR -->
			<plugin>
				<groupId>com.akathist.maven.plugins.launch4j</groupId>
				<artifactId>launch4j-maven-plugin</artifactId>
				<version>1.7.25</version>
				<configuration>
					<skip>${assembly.skipAssembly}</skip>

					<headerType>gui</headerType>
					<jar>target/FisherMail.jar</jar>
					<outfile>target/FisherMail.exe</outfile>
					<errTitle>FisherMail Error</errTitle>
					<classPath>
						<mainClass>net.anfoya.mail.client.javafx.entrypoint.MailClient</mainClass>
					</classPath>
					<icon>../mail-common/src/main/resources/net/anfoya/mail/img/Mail.ico</icon>
					<jre>
						<path>jre</path>
						<minVersion>1.8.0</minVersion>
						<initialHeapSize>128</initialHeapSize>
						<maxHeapSize>1024</maxHeapSize>
					</jre>
					<versionInfo>
						<fileVersion>1.0.0.0</fileVersion>
						<txtFileVersion>1.0.0.0</txtFileVersion>
						<fileDescription>FisherMail</fileDescription>
						<copyright>speederpan.com</copyright>
						<productVersion>1.0.0.0</productVersion>
						<txtProductVersion>1.0.0.0</txtProductVersion>
						<productName>FisherMail</productName>
						<internalName>FisherMail</internalName>
						<originalFilename>FisherMail.exe</originalFilename>
					</versionInfo>
				</configuration>
				<executions>
					<execution>
						<phase>package</phase>
						<goals>
							<goal>launch4j</goal>
						</goals>
					</execution>
				</executions>
			</plugin>

			<!-- win installers -->
			<!-- ..needs inno-setup to be installed and available in path -->
			<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>exec-maven-plugin</artifactId>
				<version>1.6.0</version>
				<configuration>
					<skip>${assembly.skipAssembly}</skip>

					<mainClass>de.audi.analysis.main.Main</mainClass>
					<executable>ISCC.exe</executable>
					<workingDirectory></workingDirectory>
				</configuration>
				<executions>
					<execution>
						<id>win32</id>
						<phase>install</phase>
						<goals>
							<goal>exec</goal>
						</goals>
						<configuration>
							<arguments>
								<argument>innosetup-win32.iss</argument>
							</arguments>
						</configuration>
					</execution>
					<execution>
						<id>win64</id>
						<phase>install</phase>
						<goals>
							<goal>exec</goal>
						</goals>
						<configuration>
							<arguments>
								<argument>innosetup-win64.iss</argument>
							</arguments>
						</configuration>
					</execution>
				</executions>
			</plugin>

			<!-- build macOs binary(x64) from self contained executable JAR -->
			<!-- ..only works on *nix systems -->
			<plugin>
				<artifactId>maven-antrun-plugin</artifactId>
				<version>1.8</version>
				<dependencies>
					<dependency>
						<groupId>com.panayotis</groupId>
						<artifactId>appbundler</artifactId>
						<version>1.0.1</version>
					</dependency>
				</dependencies>
				<configuration>
					<skip>${assembly.skipAssembly}</skip>

					<target>
						<!-- create App bundle for Mac -->
						<taskdef name="bundleapp"
							classname="com.oracle.appbundler.AppBundlerTask"
							classpathref="maven.plugin.classpath" />
						<bundleapp outputdirectory="target" name="FisherMail"
							displayname="FisherMail"
							icon="../mail-common/src/main/resources/net/anfoya/mail/img/Mail.icns"
							identifier="net.anfoya.mail-client" shortversion="2.0"
							copyright="speederpan.com"
							mainclassname="net.anfoya.mail.client.javafx.entrypoint.MailClient">
							<classpath file="target/FisherMail.jar" />
							<option value="-Xmx1g" />
							<runtime dir="jre/macos/jdk1.8.0_162.jdk/Contents/Home" />
						</bundleapp>
					</target>
				</configuration>
				<executions>
					<execution>
						<id>macAppBundle</id>
						<phase>package</phase>
						<goals>
							<goal>run</goal>
						</goals>
					</execution>
				</executions>
			</plugin>

			<!-- deb packages -->
			<plugin>
				<artifactId>jdeb</artifactId>
				<groupId>org.vafer</groupId>
				<version>1.8</version>
				<executions>
					<execution>
						<id>lin64</id>
						<phase>package</phase>
						<goals>
							<goal>jdeb</goal>
						</goals>
						<configuration>
							<skipPOMs>false</skipPOMs>
							<deb>${project.basedir}/target/FisherMail-lin64.deb</deb>
							<controlDir>${project.basedir}/src/deploy/deb/control</controlDir>
							<installDir>/opt/FisherMail</installDir>
							<dataSet>
								<data>
									<type>file</type>
									<src>${project.basedir}/target/FisherMail.jar</src>
									<dst>/opt/FisherMail/FisherMail.jar</dst>
									<mapper>
										<type>perm</type>
										<filemode>755</filemode>
									</mapper>
								</data>
								<data>
									<type>file</type>
									<src>${project.basedir}/src/deploy/bash/FisherMail-deb.sh</src>
									<dst>/usr/bin/fishermail</dst>
									<mapper>
										<type>perm</type>
										<filemode>755</filemode>
									</mapper>
								</data>
								<data>
									<type>directory</type>
									<src>${project.basedir}/jre/lin64/jre1.8.0_231</src>
									<mapper>
										<type>perm</type>
										<prefix>/opt/FisherMail/jre</prefix>
										<filemode>755</filemode>
									</mapper>
								</data>
							</dataSet>
						</configuration>
					</execution>
					<execution>
						<id>lin32</id>
						<phase>package</phase>
						<goals>
							<goal>jdeb</goal>
						</goals>
						<configuration>
							<skipPOMs>false</skipPOMs>
							<deb>${project.basedir}/target/FisherMail-lin32.deb</deb>
							<controlDir>${project.basedir}/src/deploy/deb/control</controlDir>
							<installDir>/opt/FisherMail</installDir>
							<dataSet>
								<data>
									<type>file</type>
									<src>${project.basedir}/target/FisherMail.jar</src>
									<dst>/opt/FisherMail/FisherMail.jar</dst>
									<mapper>
										<type>perm</type>
										<filemode>755</filemode>
									</mapper>
								</data>
								<data>
									<type>file</type>
									<src>${project.basedir}/src/deploy/bash/FisherMail-deb.sh</src>
									<dst>/usr/bin/fishermail</dst>
									<mapper>
										<type>perm</type>
										<filemode>755</filemode>
									</mapper>
								</data>
								<data>
									<type>directory</type>
									<src>${project.basedir}/jre/lin32/jre1.8.0_231</src>
									<mapper>
										<type>perm</type>
										<prefix>/opt/FisherMail/jre</prefix>
										<filemode>755</filemode>
									</mapper>
								</data>
							</dataSet>
						</configuration>
					</execution>
				</executions>
			</plugin>

			<!-- zip packages for macOs and other linux flavours -->
			<plugin>
				<artifactId>maven-assembly-plugin</artifactId>
				<version>3.1.0</version>
				<executions>
					<execution>
						<id>build-platform-dependent-packages</id>
						<phase>install</phase>
						<goals>
							<goal>single</goal>
						</goals>
						<configuration>
							<finalName>FisherMail</finalName>
							<attach>false</attach>
							<descriptors>
								<descriptor>assembly-macos.xml</descriptor>
								<descriptor>assembly-lin32.xml</descriptor>
								<descriptor>assembly-lin64.xml</descriptor>
							</descriptors>
						</configuration>
					</execution>
					<execution>
						<id>move-to-distrib</id>
						<phase>install</phase>
						<goals>
							<goal>single</goal>
						</goals>
						<configuration>
							<finalName>distrib</finalName>
							<outputDirectory>${project.basedir}</outputDirectory>
							<appendAssemblyId>false</appendAssemblyId>
							<attach>false</attach>
							<descriptors>
								<descriptor>assembly-distrib.xml</descriptor>
							</descriptors>
						</configuration>
					</execution>
				</executions>
			</plugin>
		</plugins>
	</build>
</project>
